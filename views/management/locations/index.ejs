<% layout('layouts/web.ejs') -%>

<div class="container-fluid">
  <div class="header-route">
    <h3 class="mb-4">
      <i class="fa fa-map-marker me-2"></i>
      <a href="/">Administración </a> / <a href="/">Datos Maestros </a> / Gestión de Locaciones </h3>
  </div>

  <!-- Mostrar mensajes de error si existen -->
  <%- include('../../partials/flash_messages') %>

  <div class="row">
    <div class="col-12">
      <div class="card mb-4">
        <div class="card-header p-2">
          <h6 class="mb-0">
            <i class="fa fa-info-circle me-2"></i>
            Prueba de Autocompletado de Búsqueda de Locaciones
          </h6>
        </div>
        <div class="card-body p-3">
          <div class="col-md-5 autocomplete-wrapper" style="overflow-x: auto; white-space: nowrap;">
            <label class="form-label">Nombre de la Provincia</label>
            <input type="text" id="searchInput" class="form-control" placeholder="Buscar...">
            <input type="hidden" id="selectedId">
            <div id="suggestionsContainer" class="suggestion-list"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card mb-4">
    <div class="card-header">
      <h6 class="mb-0">
        <i class="fa fa-list me-2"></i>
        Lista de Departamentos / Provincias / Distritos
      </h6>
    </div>
    <div class="card-body">
      <div class="row">
        <!-- ================= DEPARTMENTS ================= -->
        <div class="col-md-4">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5>Departamentos del Perú</h5>
            <a href="/management/locations/departments" class="btn btn-primary">
              <i class="fa fa-plus"></i> Agregar
            </a>
          </div>

          <table class="table table-sm table-hover">
            <thead>
              <tr>
                <th>Nombre</th>
                <th class="text-end">Acciones</th>
              </tr>
            </thead>
            <tbody>
              <% if (departments && departments.length > 0) { %>
                <% departments.forEach(function(l) { %>
                  <tr>
                    <td><%= l.name %></td>
                    <td class="text-end">
                      <div class="btn-group btn-group-sm">
                        <a href="/management/locations/<%= l.id %>/provinces"
                          class="btn btn-outline-primary">
                          <i class="fa fa-map-marker"></i>
                          Provincias
                        </a>
                        <a href="/management/locations/<%= l.id %>/edit"
                          class="btn btn-outline-secondary">
                          <i class="fa fa-pencil"></i>
                          Editar
                        </a>
                        <a href="/management/locations/<%= l.id %>/delete"
                          class="btn btn-outline-danger"
                          onclick="return confirm('¿Eliminar departamento?')">
                          <i class="fa fa-trash"></i>
                          Eliminar
                        </a>
                      </div>
                    </td>
                  </tr>
                <% }) %>
              <% } else { %>
                <tr>
                  <td colspan="2" class="text-center text-muted">Sin registros</td>
                </tr>
              <% } %>
            </tbody>
          </table>
        </div>


        <!-- ================= PROVINCES ================= -->
        <% if (provinces) { %>
        <div class="col-md-4">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5>Provincias de <%= department.name %></h5>
            <a href="/management/locations/<%= department.id %>/provinces/add" class="btn btn-primary">
              <i class="fa fa-plus"></i> Agregar
            </a>
          </div>

          <table class="table table-sm table-hover">
            <thead>
              <tr>
                <th>Nombre</th>
                <th class="text-end">Acciones</th>
              </tr>
            </thead>
            <tbody>
              <% if (provinces.length > 0) { %>
                <% provinces.forEach(function(l) { %>
                  <tr>
                    <td><%= l.name %></td>
                    <td class="text-end">
                      <div class="btn-group btn-group-sm">
                        <a href="/management/locations/<%= department.id %>/provinces/<%= l.id %>/districts"
                          class="btn btn-outline-primary">
                          <i class="fa fa-map-marker"></i>
                          Distritos
                        </a>
                        <a href="/management/locations/<%= department.id %>/provinces/<%= l.id %>/edit"
                          class="btn btn-outline-secondary">
                          <i class="fa fa-pencil"></i>
                          Editar
                        </a>
                        <a href="/management/locations/<%= department.id %>/provinces/<%= l.id %>/delete"
                          class="btn btn-outline-danger"
                          onclick="return confirm('¿Eliminar provincia?')">
                          <i class="fa fa-trash"></i>
                          Eliminar
                        </a>
                      </div>
                    </td>
                  </tr>
                <% }) %>
              <% } else { %>
                <tr>
                  <td colspan="2" class="text-center text-muted">Sin registros</td>
                </tr>
              <% } %>
            </tbody>
          </table>
        </div>
        <% } %>


        <!-- ================= DISTRICTS ================= -->
        <% if (districts) { %>
        <div class="col-md-4">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5>Distritos de <%= province.name %></h5>
            <a href="/management/locations/<%= department.id %>/provinces/<%= province.id %>/districts/add"
              class="btn btn-primary">
              <i class="fa fa-plus"></i> Agregar
            </a>
          </div>

          <table class="table table-sm table-hover">
            <thead>
              <tr>
                <th>Nombre</th>
                <th class="text-end">Acciones</th>
              </tr>
            </thead>
            <tbody>
              <% if (districts.length > 0) { %>
                <% districts.forEach(function(l) { %>
                  <tr>
                    <td><%= l.name %></td>
                    <td class="text-end">
                      <div class="btn-group btn-group-sm">
                        <a href="/management/locations/<%= department.id %>/provinces/<%= province.id %>/districts/<%= l.id %>/edit"
                          class="btn btn-outline-secondary">
                          <i class="fa fa-pencil"></i>
                          Editar
                        </a>
                        <a href="/management/locations/<%= department.id %>/provinces/<%= province.id %>/districts/<%= l.id %>/delete"
                          class="btn btn-outline-danger"
                          onclick="return confirm('¿Eliminar distrito?')">
                          <i class="fa fa-trash"></i>
                          Eliminar
                        </a>
                      </div>
                    </td>
                  </tr>
                <% }) %>
              <% } else { %>
                <tr>
                  <td colspan="2" class="text-center text-muted">Sin registros</td>
                </tr>
              <% } %>
            </tbody>
          </table>
        </div>
        <% } %>

      </div>
    </div>
  </div>
</div>

<% block('styles').append(`

`) %>

<% block('scripts').append(`
  
`) %>